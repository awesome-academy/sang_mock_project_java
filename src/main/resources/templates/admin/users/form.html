<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{admin/layout :: layout(~{::section})}">
<head><title>User Form</title></head>
<body>
<section>
    <div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2" th:text="${pageTitle}">Form</h1>
        <a th:href="@{/admin/users}" class="btn btn-secondary btn-sm">Back</a>
    </div>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <div class="card shadow-sm col-lg-8 mx-auto">
        <div class="card-body">
            <form th:action="${user.id == null} ? @{/admin/users/save} : @{/admin/users/update/{id}(id=${user.id})}"
                  th:object="${user}" method="post">
                
                <div class="mb-3">
                    <label class="form-label">Full Name <span class="text-danger">*</span></label>
                    <input type="text" th:field="*{name}" class="form-control" 
                           th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'">
                    <div class="invalid-feedback" th:errors="*{name}"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Email <span class="text-danger">*</span></label>
                    <input type="email" th:field="*{email}" class="form-control" 
                           th:classappend="${#fields.hasErrors('email')} ? 'is-invalid'"
                           th:readonly="${user.id != null}">
                    <div class="invalid-feedback" th:errors="*{email}"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input type="password" th:field="*{password}" class="form-control" 
                           th:classappend="${#fields.hasErrors('password')} ? 'is-invalid'"
                           placeholder="Leave empty to keep current password">
                    <div class="invalid-feedback" th:errors="*{password}"></div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Roles</label>
                    <div>
                        <div class="form-check form-check-inline" th:each="role : ${roles}">
                            <input class="form-check-input" type="checkbox" 
                                   th:field="*{roleIds}" 
                                   th:value="${role.id}">
                            <label class="form-check-label" th:text="${role.name}"></label>
                        </div>
                    </div>
                </div>

                <div class="mb-3 form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="isActive" th:field="*{isActive}">
                    <label class="form-check-label" for="isActive">Active Account</label>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">Save User</button>
                </div>
            </form>
        </div>
    </div>
</section>
</body>
</html>